# ROCm-enabled override for TTS service (AMD GPU)
# Usage: docker compose -f docker-compose.yml -f docker-compose.rocm.yml up -d
#
# Prerequisites:
# 1. AMD GPU compatible with ROCm 6.0+
#    - Compatible GPUs: RX 6000/7000 series, Radeon Pro, Instinct MI series
#    - Check compatibility: https://rocm.docs.amd.com/en/latest/release/gpu_os_support.html
# 2. ROCm 6.0+ installed on host system
# 3. User added to 'render' and 'video' groups
# 4. Docker configured with ROCm runtime (see /etc/docker/daemon.json)
#
# Installation (Ubuntu 22.04):
#   wget https://repo.radeon.com/amdgpu-install/6.0/ubuntu/jammy/amdgpu-install_6.0.60000-1_all.deb
#   sudo apt-get install ./amdgpu-install_6.0.60000-1_all.deb
#   sudo amdgpu-install -y --usecase=rocm
#   sudo usermod -a -G render,video $USER
#
# HSA_OVERRIDE_GFX_VERSION values:
#   - RX 6000 series (RDNA 2): 10.3.0
#   - RX 7000 series (RDNA 3): 11.0.0
#   - Check your GPU: rocminfo | grep gfx

services:
  tts-service:
    devices:
      # KFD (Kernel Fusion Driver) for compute operations
      - /dev/kfd
      # DRI (Direct Rendering Infrastructure) for graphics
      - /dev/dri
    group_add:
      # Required groups for ROCm device access
      - video
      - render
    environment:
      # Specify which GPU to use (0 for first GPU, 1 for second, etc.)
      - ROCM_VISIBLE_DEVICES=0
      # Override GFX version if needed (set according to your GPU model)
      # Uncomment and modify for your specific GPU:
      # - HSA_OVERRIDE_GFX_VERSION=10.3.0
      # ROCm runtime will use CUDA API compatibility layer
      - HSA_ENABLE_SDMA=0
